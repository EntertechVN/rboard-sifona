extends layout

block content
    div#app.row
        div(v-for="bkd in bkds").col-5
            div.board-container
                table.board
                    tr
                        td MỤC TIÊU NGÀY
                        td
                            span.value {{ bkd.MTNgay }}
                    tr
                        td MỤC TIÊU HIỆN TẠI
                        td
                            span.value {{ bkd.MThientai }}
                    tr
                        td SẢN LƯỢNG THỰC TẾ
                        td
                            span.value {{ bkd.SLThucte }}
                    tr
                        td CHÊNH LỆCH
                        td
                            span.value 0
                    tr
                        td HIỆU SUẤT (%)
                        td
                            span.value 0
                            span  %
            div
                table#bkd-setting
                    tr
                        td  Cycle (giây):
                            input(type='number')#CycleTime
                        td
                            button(v-on:click='submitCycleTime')#SubmitCycleTime Submit
                    tr
                        td  Mục tiêu ngày:
                            input(type='number')#MTNgay
                        td
                            button(v-on:click='submitMTNgay')#SubmitMTNgay Submit
    script.
        var socket = io()
        var app = new Vue({
            el: '#app',
            data: {
                bkds: [{MThientai: 0, SLThucte: 0}]
            },

            methods: {
                submitCycleTime: function () {
                    let elemCycleTime = $('#CycleTime')
                    let cycleTimeValue = elemCycleTime.val()

                    if (parseInt(cycleTimeValue)) {
                        let ok = confirm('Đồng ý cập nhật cycle time với giá trị ' + cycleTimeValue + '?')

                        if (ok) {
                            socket.emit('update CycleTime', cycleTimeValue)

                            // empty the value
                            elemCycleTime.val('')
                        }
                    }
                },
                submitMTNgay: function () {
                    let elemMTNgay = $('#MTNgay')
                    let mtNgayValue = elemMTNgay.val()

                    if (parseInt(mtNgayValue)) {
                        let ok = confirm('Đồng ý cập nhật mục tiêu ngày với giá trị ' + mtNgayValue + '?')

                        if (ok) {
                            socket.emit('update MTNgay', mtNgayValue)

                            // empty the value
                            elemMTNgay.val('')
                        }
                    }
                }
            }
        })

        socket.on('connect', function () {
            console.log('connected')
            socket.emit('get data')
        })

        socket.on('disconnect', function () {
            console.log('disconnected')
        })

        socket.on('set data', function (data) {
            console.log(data)
            app.bkds = data.bkds
        })

        socket.on('data updated', function () {
            socket.emit('get data')
        })